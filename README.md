# mchain-monitor

**Требования:**

1. python3.5 или выше
2. установленные модули для python: _web3_, _psutil_
3. в настройках узла Мастерчейн должен быть опредеден ip и порт для подключения к API через webscoket: параметры _WSHost_ и _WSPort_ в _config.toml_

**Использование**

1. Внести изменения в файл config.ini в соответствии с имеющейся конфигурацией Мастерчейн
2. Запустить агент командой `/usr/bin/python3 ./mchain_monitor.py`

**Описание**

Агент подключается к узлу Мастерчейн по websocket и после получения нового блока записывает наблюдаемую информацию в журнал _agent.log_ в формате python dictionary.
Формат записи:

```python
{
"timestamp": "2019-11-05 10:48:16.654307",
"utctimestamp": "1572932896.6543276",
"block": {
"difficulty": 24995011,
"proofOfAuthorityData": HexBytes(
"0x000000000000000003000000000000000100000000000000b66b8214000000004f314f5efaf5b9f08b037ab0970050cef2ddfa46b7e0c715aa43679790c8dfffc776e588d3ed56cf38b97d58f5f2f507596b504cf46ae68d4ef93768b3ecd8f900"
),
"gasLimit": 4712388,
"gasUsed": 0,
"hash": HexBytes("0x91f01e5015f1f3bde2247940a84cb77764342c970cc4f18475d4c98f01dbd706"),
"logsBloom": HexBytes(
"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
),
"miner": "0x97B2Af83F100315cB48518b4D2bFAb6f33dE13B6",
"mixHash": HexBytes("0x747f2a1736e86c7fcb5fba31159ac0884418a20e0867b98d207f10ab5d26e595"),
"nonce": HexBytes("0x74c1f035d240c82a"),
"number": 342314,
"parentHash": HexBytes("0x7c2c0466d03bf917a8dfa9b3dca96365785b5f549b8e27fdbd60a4de84ffb9b6"),
"receiptsRoot": HexBytes("0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421"),
"sha3Uncles": HexBytes("0x387a97e83987ddde24621aec325689ede1ee517344bbb732bce854e45fb91b00"),
"signer": "0x97b2af83f100315cb48518b4d2bfab6f33de13b6",
"signerNodeVersion": "0.3.1_b66b8214",
"size": 613,
"stateRoot": HexBytes("0x309f4e94c85cfe8fe029d58777eac7bc9e4884f3c810b0dfdaa11cc527a3f881"),
"timestamp": 1572932875,
"totalDifficulty": 8675920615915,
"transactions": [],
"transactionsRoot": HexBytes(
"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421"
),
"uncles": []
},
"system": {
"uname": [
"Linux",
"mchain101-01",
"4.15.0-45-generic",
"#48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019",
"x86_64"
],
"cpu_count": 8,
"mem_total": 8317218816,
"disk_info": {
"/": [19232243712, 13999734784, 4231958528, 76.8],
"/boot": [754434048, 77111296, 639000576, 10.8]
},
"cpu_load": 45.4,
"mem_load": 51.7
}
}
```

**To Do**

1. На текущий момент поддерживается только вывод информации в файл, необходимо дописать возможность отправки на сервер удаленного мониторинга (например, POST-запросом)
2. "Демонизировать" агент
